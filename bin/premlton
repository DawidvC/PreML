#!/bin/bash
hash preml 2>&- || { echo >&2 "PreML is not installed.  Aborting."; exit 1; }
hash mlton 2>&- || { echo >&2 "MLTon is not installed.  Aborting."; exit 1; }

if [ $1 ]; then
   cd "`dirname $1`"
   SRC="`basename $1`"
   DST=".premlton.$SRC"
   preml "$SRC" -o "$DST"
   echo ""
   echo "Preprocessing done.  Running mlton."
   mlton -output "`basename "$SRC" .mlb`" "$DST"
   preml "$SRC" -o "$DST" -c -q
else
   echo "Usage: $0 <file>"
fi

